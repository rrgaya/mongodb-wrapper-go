# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build_mongo:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Criando container MongoDB
      id: build_mongo_docker
      uses: docker://rrgaya/mongodb:latest
      with:
        image-version: latest
        port: 27017

    - name: Testando conexão com o MongoDB
      id: test_mongo_connection
      run: | 
        sudo mongo localhost:27017
        sleep(10000);
        exit 1
        
  build_go:
    runs-on: ubuntu-latest
    name: Test mongo-action
    steps:
      - uses: actions/checkout@v3

      - name: Set up Go
          uses: actions/setup-go@v3
          with:
            go-version: 1.19

      - name: Build
          run: go build -v ./...

      - name: Tests Unitários
        run: go test -v ./...
          env:
            CI: True
